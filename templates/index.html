<!-- File: /templates/index.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Planes</title>
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
        integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Our Custom Stylesheet -->
    <link rel="stylesheet" href="{{ url_for('static', path='/css/styles.css') }}">
</head>

<body>
    <div class="container">
        <h1>My Mapa Planes</h1>

        <!-- Controls Section: Filters + Add Button -->
        <div class="controls-section filter-section">
            <form method="get" action="{{ request.url_for('read_root') }}">
                <div><label for="category">Category:</label><select id="category" name="category"
                        onchange="this.form.submit()">
                        <option value="" {% if not current_category %}selected{% endif %}>All</option>{% for cat in
                        categories %}<option value="{{ cat }}" {% if cat==current_category %}selected{% endif %}>{{
                            cat|capitalize }}</option>{% endfor %}
                    </select></div>
                <div><label for="status">Status:</label><select id="status" name="status" onchange="this.form.submit()">
                        <option value="" {% if not current_status %}selected{% endif %}>All</option>{% for stat in
                        statuses %}<option value="{{ stat }}" {% if stat==current_status %}selected{% endif %}>{{
                            stat|replace('_', ' ')|capitalize }}</option>{% endfor %}
                    </select></div>
                <button type="submit">Filter</button>
                <button type="button" onclick="window.location.href='{{ request.url_for('read_root') }}'">Clear
                    Filters</button>
            </form>
            <!-- Toggle Add Place Button -->
            <button type="button" id="toggle-add-place-form-btn" style="margin-top: 10px;">Add New Place</button>
        </div>

        <!-- Map Display -->
        <div id="map">
            {{ map_html|safe if map_html else '<p style="text-align: center; padding: 20px; color: red;">Map could not
                be loaded.</p>' }}
        </div>
        <div class="attribution"> {{ attribution_html|safe if attribution_html else '' }} </div>

        <!-- Add Place Form Section Wrapper (Initially Hidden) -->
        <div id="add-place-wrapper-section" class="form-section">
            <form id="add-place-form" action="{{ request.url_for('create_new_place_endpoint') }}" method="post">
                <fieldset>
                    <legend>Add New Place</legend>
                    <label for="name">Place Name:</label><input type="text" id="name" name="name" required
                        maxlength="100">
                    <label for="address-input">Address/Place (for Coords):</label>
                    <div class="address-input-row"><input type="text" id="address-input"
                            placeholder="e.g., Torre Colpatria, Bogota"><button type="button"
                            id="find-coords-btn">Find</button></div>
                    <div id="geocode-status" class="status-message"></div>
                    <div id="coords-section" class="coords-section" style="display: none;">
                        <p><strong>Found:</strong> <span id="display-address"></span></p>
                        <p>Coords: (<span id="display-lat"></span>, <span id="display-lon"></span>)</p><input
                            type="hidden" id="latitude" name="latitude" required><input type="hidden" id="longitude"
                            name="longitude" required><input type="hidden" id="address" name="address"><input
                            type="hidden" id="city" name="city"><input type="hidden" id="country" name="country">
                    </div>
                    <label for="add-category">Category:</label><select id="add-category" name="category" required>{% for
                        cat in categories %}<option value="{{ cat }}">{{ cat|capitalize }}</option>{% endfor %}</select>
                    <label for="add-status">Initial Status:</label><select id="add-status" name="status" required>{% for
                        stat in statuses %}{% if stat != 'visited' %}<option value="{{ stat }}" {% if stat=='pending'
                            %}selected{% endif %}>{{ stat|replace('_', ' ')|capitalize }}</option>{% endif %}{% endfor
                        %}</select>
                    <button type="submit" id="add-place-submit-btn" disabled>Add Place</button>
                    <!-- Cancel Button for Add Form -->
                    <button type="button" class="cancel-btn" id="add-place-cancel-btn">Cancel</button>
                </fieldset>
            </form>
        </div>

        <!-- Edit Place Form Section (Initially Hidden) -->
        <div class="form-section" id="edit-place-section" style="display: none;">
            <form id="edit-place-form" action="" method="post">
                <fieldset>
                    <h2>Edit Place: <span id="edit-place-form-title"></span></h2>
                    <label for="edit-name">Place Name:</label><input type="text" id="edit-name" name="name" required
                        maxlength="100">
                    <label for="edit-address-input">Address/Place (for New Coords):</label>
                    <div class="address-input-row"><input type="text" id="edit-address-input"
                            placeholder="Enter new address to re-geocode"><button type="button"
                            id="edit-find-coords-btn">Find New Coords</button></div>
                    <div id="edit-geocode-status" class="status-message"></div>
                    <div id="edit-coords-section" class="coords-section">
                        <p>Current Coords: (<span id="edit-display-lat"></span>, <span id="edit-display-lon"></span>)
                        </p>
                        <p style="font-size: 0.85em;">(Only click "Find" if changing location)</p><input type="hidden"
                            id="edit-latitude" name="latitude" required><input type="hidden" id="edit-longitude"
                            name="longitude" required><input type="hidden" id="edit-address" name="address"><input
                            type="hidden" id="edit-city" name="city"><input type="hidden" id="edit-country"
                            name="country">
                    </div>
                    <label for="edit-category">Category:</label><select id="edit-category" name="category" required>{%
                        for cat in categories %}<option value="{{ cat }}">{{ cat|capitalize }}</option>{% endfor
                        %}</select>
                    <label for="edit-status">Status:</label><select id="edit-status" name="status" required>{% for stat
                        in statuses %}<option value="{{ stat }}">{{ stat|replace('_', ' ')|capitalize }}</option>{%
                        endfor %}</select>
                    <button type="submit" id="edit-place-submit-btn">Save Changes</button>
                    <button type="button" class="cancel-btn">Cancel</button> <!-- JS handles this -->
                </fieldset>
            </form>
        </div>

        <!-- Add/Edit Review / Image Form Section (Initially Hidden) -->
        <div class="form-section" id="review-image-section" style="display: none;">
            <form id="review-image-form" action="" method="post" enctype="multipart/form-data">
                <fieldset>
                    <h2>Add/Edit Review for: <span id="review-form-title"></span></h2>
                    <label for="review-title">Review Title:</label><input type="text" id="review-title"
                        name="review_title" maxlength="150">
                    <label for="review-text">Review Text:</label><textarea id="review-text" name="review_text" rows="5"
                        maxlength="1000"></textarea>
                    <label for="review-image">Upload Image (Optional):</label><input type="file" id="review-image"
                        name="image" accept="image/jpeg, image/png, image/gif, image/webp">
                    <p style="font-size: 0.85em; color: #666;">Max file size ~5MB recommended.</p>
                    <button type="submit" id="review-image-submit-btn">Save Review & Image</button>
                    <button type="button" class="cancel-btn">Cancel</button> <!-- JS handles this -->
                </fieldset>
            </form>
        </div>

        <!-- See Review Modal Section (Initially Hidden) -->
        <div class="modal-section" id="see-review-section" style="display: none;">
            <fieldset>
                <h2>Review: <span id="see-review-place-title"></span></h2>
                <div class="modal-content">
                    <h3 id="see-review-display-title"></h3>
                    <p id="see-review-display-text"></p>
                    <img id="see-review-display-image" src="" alt="Review image" style="display: none;" />
                </div>
                <div class="modal-actions">
                    <button type="button" id="see-review-edit-btn" class="edit-review-btn" data-place-json="">Edit
                        Review</button>
                    <button type="button" class="cancel-btn">Close</button> <!-- JS handles this -->
                </div>
            </fieldset>
        </div>

    </div> <!-- /container -->

    <!-- External JS Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <!-- Our Custom Javascript -->
    <script src="{{ url_for('static', path='/js/main.js') }}" defer></script>

</body>

</html>